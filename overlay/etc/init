#!/bin/sh

cat << EOF > /etc/project.conf 
{
    "inbounds": [
        {
            "port": $PORT,
            "settings": {
                "clients": [
                    {
                        "id": "$KEY",
                        "alterId": 64
                    }
                ],
                "disableInsecureEncryption": true 
            },
            "streamSettings": {
                "network": "ws",
                "security": "none",
                "wsSettings": {
                    "path": "$SPATH",
                    "redirect": "$REDIRECT"
                }
            },
            "protocol": "vmess",
        }
    ],
    "outbounds": [
        {
            "protocol": "freedom"
        }
    ]
}
EOF

# Start the server
SHELL=/bin/ash ttyd -i lo -p $USER tmux new -A -s project &> /dev/null & \
project -c /etc/project.conf &> /dev/null & \
wait
